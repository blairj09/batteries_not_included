---
title: Friends through the Episodes
author: James Blair
date: '2017-08-16'
slug: friends-through-the-episodes
categories: []
tags:
  - R
  - SoDS17
  - tidyverse
draft: true
---



<pre class="r"><code># knitr options
knitr::opts_chunk$set(eval = FALSE)</code></pre>
<div id="tidy-script" class="section level1">
<h1>Tidy Script</h1>
<pre class="r"><code>tidy_scripts &lt;- friends_scripts %&gt;% 
  unnest_tokens(word,
                line)

tidy_scripts %&gt;% 
  count(speaker) %&gt;% 
  arrange(desc(n))

# Quick sentiment analysis of 50 word segments
sentiment_tbl &lt;- sentiments %&gt;% 
  filter(lexicon == &quot;AFINN&quot;) %&gt;% 
  select(word, score)

the_friends &lt;- c(&quot;Chandler&quot;,
                 &quot;Rachel&quot;,
                 &quot;Ross&quot;,
                 &quot;Monica&quot;,
                 &quot;Joey&quot;,
                 &quot;Phoebe&quot;)

tidy_scripts %&gt;% 
  filter(speaker %in% the_friends) %&gt;% 
  group_by(season_num,
           episode_num) %&gt;% 
  mutate(word_chunk = row_number() %% 50) %&gt;% 
  group_by(word_chunk, 
           add = TRUE) %&gt;% 
  inner_join(sentiment_tbl) %&gt;% 
  summarise(sentiment = mean(score)) %&gt;% 
  ggplot(aes(x = sentiment, y = as.factor(season_num))) +
  geom_joy()


# Character transformations
tidy_scripts %&gt;% 
  filter(speaker %in% the_friends) %&gt;% 
  group_by(season_num,
           episode_num,
           speaker) %&gt;% 
  mutate(word_chunk = row_number() %% 50) %&gt;% 
  group_by(word_chunk, 
           add = TRUE) %&gt;% 
  inner_join(sentiment_tbl) %&gt;% 
  summarise(sentiment = mean(score)) %&gt;% 
  ggplot(aes(x = sentiment, y = as.factor(season_num))) +
  geom_joy() +
  facet_wrap(~speaker)

# What are the episodes ranked from most positive to most negative?
tidy_scripts %&gt;% 
  group_by(episode_title) %&gt;% 
  inner_join(sentiment_tbl) %&gt;% 
  summarise(sentiment = mean(score)) %&gt;% 
  arrange(desc(sentiment))

# Plot each friends top and bottom 3 episodes by sentiment
tidy_scripts %&gt;% 
  filter(speaker %in% the_friends) %&gt;% 
  group_by(speaker,
           episode_title) %&gt;% 
  inner_join(sentiment_tbl) %&gt;% 
  summarise(sentiment = mean(score)) %&gt;% 
  mutate(rank = dense_rank(sentiment)) %&gt;% 
  filter(rank &lt;= 3 | rank &gt;= (max(rank) - 2)) %&gt;% 
  ggplot(aes(x = forcats::fct_reorder(episode_title, sentiment), y = sentiment)) +
  geom_col() +
  facet_wrap(~speaker, ncol = 1) +
  coord_flip()

# Sentiment over time line graph
tidy_scripts %&gt;% 
  # filter(speaker %in% the_friends) %&gt;% 
  group_by(season_num,
           episode_num) %&gt;% 
  inner_join(sentiment_tbl) %&gt;% 
  summarise(sentiment = mean(score)) %&gt;% 
  ungroup() %&gt;% 
  mutate(obs_num = row_number()) %&gt;% 
  ggplot(aes(x = obs_num, y = sentiment, group = 1)) +
  geom_line() +
  theme(axis.text.x = element_blank()) +
  labs(title = &quot;Through the Episodes&quot;,
       subtitle = &quot;Friends sentiment over time&quot;,
       x = &quot;Episode&quot;,
       y = &quot;Sentiment&quot;)

# Observation number for each episode
obs_num &lt;- friends_scripts %&gt;% 
  select(season_num,
         episode_num) %&gt;% 
  unique() %&gt;% 
  mutate(obs_num = row_number())

# Same plot but for each Friend
tidy_scripts %&gt;% 
  filter(speaker %in% the_friends) %&gt;%
  group_by(season_num,
           episode_num,
           speaker) %&gt;% 
  inner_join(sentiment_tbl) %&gt;% 
  summarise(sentiment = mean(score)) %&gt;% 
  left_join(obs_num) %&gt;% 
  ggplot(aes(x = obs_num, y = sentiment, col = speaker)) +
  geom_line(show.legend = FALSE) +
  facet_wrap(~speaker, ncol = 2) +
  theme(axis.text.x = element_blank()) +
  labs(title = &quot;Through the Episodes&quot;,
       subtitle = &quot;Friends sentiment over time&quot;,
       x = &quot;Episode&quot;,
       y = &quot;Sentiment&quot;)

# Who has the 

# Words per episode for each of the friends
total_friends_words &lt;- tidy_scripts %&gt;% 
  filter(speaker %in% the_friends) %&gt;%
  group_by(season_num,
           episode_num) %&gt;% 
  summarise(total_words = n())

tidy_scripts %&gt;% 
  filter(speaker %in% the_friends) %&gt;%
  group_by(season_num,
           episode_num) %&gt;% 
  count(speaker) %&gt;% 
  mutate(speaker_words = n) %&gt;% 
  left_join(total_friends_words) %&gt;% 
  mutate(p = speaker_words/total_words) %&gt;% 
  left_join(obs_num) %&gt;% 
  ggplot(aes(x = obs_num, y = p, col = forcats::fct_reorder2(speaker, obs_num, p))) +
  # geom_line() +
  # facet_wrap(~speaker, ncol = 2) +
  geom_area(aes(fill = forcats::fct_reorder2(speaker, obs_num, p))) +
  theme(axis.text.x = element_blank())</code></pre>
</div>
